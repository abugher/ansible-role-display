---
gather_subset_of_facts:
  - 'distribution'
user_groups:
  - 'display'
  - 'render'            # Does not exist by default on Ubuntu Bionic.
users:
  - 'display'
add_users_to_groups:
  - user:               'display'
    groups:
      - 'audio'
      - 'video'
      - 'render'
install_packages:
  - 'mpv'
  - 'pavucontrol'
  - 'pulseaudio'
  - 'xserver-xorg'
  - 'xinit'
  - 'xscreensaver'
  - 'xscreensaver-data'
  - 'xscreensaver-data-extra'
  - 'xscreensaver-gl'
  - 'xscreensaver-gl-extra'
  - 'xscreensaver-screensaver-bsod'
  - 'xscreensaver-screensaver-dizzy'
  - 'xscreensaver-screensaver-webcollage'
  - 'i3-wm'
ubuntu_sonar_path:      '/usr/lib/xscreensaver/sonar'
debian_sonar_path:      '/usr/libexec/xscreensaver/sonar'
adjust_files:
  - owner:              'root'
    group:              'display'
    mode:               '4754'
    path:               "{{ ubuntu_sonar_path if 'Ubuntu' == ansible_facts['distribution'] else debian_sonar_path }}"
create_files:
  - owner:              'display'
    group:              'display'
    mode:               '0755'
    state:              'directory'
    path:               '/home/display'
  - owner:              'display'
    group:              'display'
    mode:               '0755'
    state:              'directory'
    path:               '/home/display/.config/i3'
  - owner:              'root'
    group:              'root'
    mode:               '0755'
    state:              'directory'
    path:               '/etc/pulse'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    state:              'touch'
    path:               '/etc/pulse/default.pa'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    state:              'touch'
    path:               '/etc/pulse/client.conf'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    state:              'touch'
    path:               '/etc/pulse/daemon.conf'
install_files:
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/Xwrapper.config"
    dest:               '/etc/X11/Xwrapper.config'
  - owner:              'root'
    group:              'root'
    mode:               '0755'
    src:                "{{ role_path }}/files/conf/rc.local"
    dest:               '/etc/rc.local'
  - owner:              'display'
    group:              'display'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/i3_config"
    dest:               '/home/display/.config/i3/config'
  - owner:              'display'
    group:              'display'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/asoundrc"
    dest:               '/home/display/.asoundrc'  
  - owner:              'display'
    group:              'display'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/xscreensaver"
    dest:               '/home/display/.xscreensaver'
  - owner:              'display'
    group:              'display'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/xinitrc"
    dest:               '/home/display/.xinitrc'
lines_in_files:
  - line:               '; flat-volumes = no'
    regexp:             'flat-volumes'
    dest:               '/etc/pulse/daemon.conf'
  - line:               'autospawn = no'
    regexp:             '^;+ +autospawn'
    dest:               '/etc/pulse/client.conf'
